{
  "meta": {
    "timestamp": "2023-12-20T11:01:06.024778",
    "version": "6.1.0",
    "argv": [
      "-j",
      "C:\\Users\\REM\\Desktop\\Practical Malware Analysis Labs\\BinaryCollection\\Chapter_14L\\Lab14-01.exe"
    ],
    "sample": {
      "md5": "53cba9af8d65fadbd0f7e5f9ff15cad3",
      "sha1": "c0c1b0c563bb9eeca89e2fd6b712aba6a119ae57",
      "sha256": "6767fd66f28a1d39cb84f59e8a86b3ea99e22d204d2aac821e0d01ac232fba56",
      "path": "C:/Users/REM/Desktop/Practical Malware Analysis Labs/BinaryCollection/Chapter_14L/Lab14-01.exe"
    },
    "analysis": {
      "format": "pe",
      "arch": "i386",
      "os": "windows",
      "extractor": "VivisectFeatureExtractor",
      "rules": [
        "C:/Users/REM/AppData/Local/Temp/_MEI12602/rules"
      ],
      "base_address": {
        "type": "absolute",
        "value": 4194304
      },
      "layout": {
        "functions": [
          {
            "address": {
              "type": "absolute",
              "value": 4198400
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4198400
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198477
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198529
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4198587
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4198587
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198657
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198672
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198695
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198731
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198760
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198775
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198806
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4198819
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4198819
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4198945
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4199045
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4199045
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4199260
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4199338
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4199370
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4200332
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4200543
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4200766
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4200791
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4200976
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201043
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201228
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201503
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201537
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201776
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201822
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201835
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201918
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201948
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201966
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4201998
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4202058
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4202087
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4202114
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4204670
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4204760
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4205125
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4205148
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4205289
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4205330
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4206736
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4206881
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4206886
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4206752
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4206780
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4206881
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4206886
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4207038
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4207069
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4209022
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4209022
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4209156
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4209192
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4209249
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4209277
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4209346
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4209591
                }
              },
              {
                "address": {
                  "type": "absolute",
                  "value": 4209706
                }
              }
            ]
          },
          {
            "address": {
              "type": "absolute",
              "value": 4211438
            },
            "matched_basic_blocks": [
              {
                "address": {
                  "type": "absolute",
                  "value": 4211459
                }
              }
            ]
          }
        ]
      },
      "feature_counts": {
        "file": 480,
        "functions": [
          {
            "address": {
              "type": "absolute",
              "value": 4198400
            },
            "count": 67
          },
          {
            "address": {
              "type": "absolute",
              "value": 4198587
            },
            "count": 48
          },
          {
            "address": {
              "type": "absolute",
              "value": 4198819
            },
            "count": 62
          },
          {
            "address": {
              "type": "absolute",
              "value": 4199045
            },
            "count": 57
          },
          {
            "address": {
              "type": "absolute",
              "value": 4199392
            },
            "count": 7
          },
          {
            "address": {
              "type": "absolute",
              "value": 4200332
            },
            "count": 195
          },
          {
            "address": {
              "type": "absolute",
              "value": 4204543
            },
            "count": 29
          },
          {
            "address": {
              "type": "absolute",
              "value": 4204670
            },
            "count": 52
          },
          {
            "address": {
              "type": "absolute",
              "value": 4204818
            },
            "count": 18
          },
          {
            "address": {
              "type": "absolute",
              "value": 4205125
            },
            "count": 86
          },
          {
            "address": {
              "type": "absolute",
              "value": 4206677
            },
            "count": 21
          },
          {
            "address": {
              "type": "absolute",
              "value": 4206752
            },
            "count": 65
          },
          {
            "address": {
              "type": "absolute",
              "value": 4207038
            },
            "count": 34
          },
          {
            "address": {
              "type": "absolute",
              "value": 4208917
            },
            "count": 25
          },
          {
            "address": {
              "type": "absolute",
              "value": 4209022
            },
            "count": 123
          },
          {
            "address": {
              "type": "absolute",
              "value": 4211438
            },
            "count": 41
          },
          {
            "address": {
              "type": "absolute",
              "value": 4214384
            },
            "count": 7
          }
        ]
      },
      "library_functions": [
        {
          "address": {
            "type": "absolute",
            "value": 4199408
          },
          "name": "_strlen"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4199536
          },
          "name": "_memset"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4199624
          },
          "name": "_sprintf"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4199712
          },
          "name": "__alloca_probe"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4199759
          },
          "name": "_mainCRTStartup"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4199982
          },
          "name": "__amsg_exit"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4200019
          },
          "name": "_fast_error_exit"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4200055
          },
          "name": "__flsbuf"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202189
          },
          "name": "_write_char"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202242
          },
          "name": "_write_multi_char"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202291
          },
          "name": "_write_string"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202347
          },
          "name": "_get_int_arg"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202360
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202376
          },
          "name": "_get_short_arg"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202390
          },
          "name": "__cinit"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202435
          },
          "name": "_exit"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202452
          },
          "name": "__exit"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202469
          },
          "name": "_doexit"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202622
          },
          "name": "__initterm"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202648
          },
          "name": "__XcptFilter"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4202969
          },
          "name": "_xcptlookup"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4203036
          },
          "name": "__setenvp"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4203221
          },
          "name": "__setargv"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4203374
          },
          "name": "_parse_cmdline"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4203810
          },
          "name": "___crtGetEnvironmentStringsA"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4204116
          },
          "name": "__ioinit"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4204604
          },
          "name": "__global_unwind2"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4204636
          },
          "name": "__unwind_handler"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4204852
          },
          "name": "__except_handler3"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4205068
          },
          "name": "__FF_MSGBANNER"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4205464
          },
          "name": "__lseek"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4205618
          },
          "name": "__write"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206047
          },
          "name": "__getbuf"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206115
          },
          "name": "__isatty"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206338
          },
          "name": "_wctomb"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206448
          },
          "name": "__aulldiv"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206560
          },
          "name": "__aullrem"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206736
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206976
          },
          "name": "_malloc"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4206994
          },
          "name": "__nh_malloc"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4207092
          },
          "name": "__setmbcp"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4207501
          },
          "name": "_getSystemCP"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4207575
          },
          "name": "_CPtoLCID"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4207626
          },
          "name": "_setSBCS"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4207667
          },
          "name": "_setSBUpLow"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208056
          },
          "name": "___initmbctable"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208096
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208208
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208252
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208288
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208348
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208600
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208632
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208672
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208756
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4208979
          },
          "name": "___sbh_find_block"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4209833
          },
          "name": "___sbh_alloc_block"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4210610
          },
          "name": "___sbh_alloc_new_region"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4210787
          },
          "name": "___sbh_alloc_new_group"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4211038
          },
          "name": "___crtMessageBoxA"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4211184
          },
          "name": "_strncpy"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4211541
          },
          "name": "__free_osfhnd"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4211663
          },
          "name": "__get_osfhandle"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4212206
          },
          "name": "__fptrap"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4212215
          },
          "name": "__callnewh"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4212242
          },
          "name": "___crtLCMapStringA"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4212790
          },
          "name": "_strncnt"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4212833
          },
          "name": "___crtGetStringTypeA"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213168
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213280
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213324
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213360
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213420
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213672
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213704
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213744
          },
          "name": "?"
        },
        {
          "address": {
            "type": "absolute",
            "value": 4213828
          },
          "name": "?"
        }
      ]
    }
  },
  "rules": {
    "create process on Windows": {
      "meta": {
        "name": "create process on Windows",
        "namespace": "host-interaction/process/create",
        "authors": [
          "moritz.raabe@mandiant.com"
        ],
        "scope": "basic block",
        "attack": [],
        "mbc": [
          {
            "parts": [
              "Process",
              "Create Process"
            ],
            "objective": "Process",
            "behavior": "Create Process",
            "method": "",
            "id": "C0017"
          }
        ],
        "references": [],
        "examples": [
          "9324D1A8AE37A36AE560C37448C9705A:0x406DB0",
          "Practical Malware Analysis Lab 01-04.exe_:0x4011FC",
          "692f7fd6d198e804d6af98eb9e390d61:0x6000003"
        ],
        "description": "",
        "lib": false,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: create process on Windows\r\n    namespace: host-interaction/process/create\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scope: basic block\r\n    mbc:\r\n      - Process::Create Process [C0017]\r\n    examples:\r\n      - 9324D1A8AE37A36AE560C37448C9705A:0x406DB0\r\n      - Practical Malware Analysis Lab 01-04.exe_:0x4011FC\r\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\r\n  features:\r\n    - or:\r\n      - api: kernel32.WinExec\r\n      - api: kernel32.CreateProcess\r\n      - api: shell32.ShellExecute\r\n      - api: shell32.ShellExecuteEx\r\n      - api: advapi32.CreateProcessAsUser\r\n      - api: advapi32.CreateProcessWithLogon\r\n      - api: advapi32.CreateProcessWithToken\r\n      - api: kernel32.CreateProcessInternal\r\n      - api: ntdll.NtCreateUserProcess\r\n      - api: ntdll.NtCreateProcess\r\n      - api: ntdll.NtCreateProcessEx\r\n      - api: ntdll.ZwCreateProcess\r\n      - api: ZwCreateProcessEx\r\n      - api: ntdll.ZwCreateUserProcess\r\n      - api: ntdll.RtlCreateUserProcess\r\n      - api: System.Diagnostics.Process::Start\r\n",
      "matches": [
        [
          {
            "type": "absolute",
            "value": 4198945
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "kernel32.WinExec"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "kernel32.CreateProcess"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4199022
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "shell32.ShellExecute"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "shell32.ShellExecuteEx"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "advapi32.CreateProcessAsUser"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "advapi32.CreateProcessWithLogon"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "advapi32.CreateProcessWithToken"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "kernel32.CreateProcessInternal"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "ntdll.NtCreateUserProcess"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "ntdll.NtCreateProcess"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "ntdll.NtCreateProcessEx"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "ntdll.ZwCreateProcess"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "ZwCreateProcessEx"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "ntdll.ZwCreateUserProcess"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "ntdll.RtlCreateUserProcess"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.Diagnostics.Process::Start"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ]
      ]
    },
    "delay execution": {
      "meta": {
        "name": "delay execution",
        "authors": [
          "michael.hunhoff@mandiant.com",
          "@ramen0x3f"
        ],
        "scope": "basic block",
        "attack": [],
        "mbc": [
          {
            "parts": [
              "Anti-Behavioral Analysis",
              "Dynamic Analysis Evasion",
              "Delayed Execution"
            ],
            "objective": "Anti-Behavioral Analysis",
            "behavior": "Dynamic Analysis Evasion",
            "method": "Delayed Execution",
            "id": "B0003.003"
          }
        ],
        "references": [
          "https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions",
          "https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp"
        ],
        "examples": [
          "al-khaser_x86.exe_:0x449770",
          "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6"
        ],
        "description": "",
        "lib": true,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: delay execution\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n      - \"@ramen0x3f\"\r\n    lib: true\r\n    scope: basic block\r\n    mbc:\r\n      - Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]\r\n    references:\r\n      - https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions\r\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp\r\n    examples:\r\n      - al-khaser_x86.exe_:0x449770\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6\r\n  features:\r\n    - or:\r\n      - and:\r\n        - os: windows\r\n        - or:\r\n          - api: kernel32.Sleep\r\n          - api: kernel32.SleepEx\r\n          - api: kernel32.WaitForSingleObject\r\n          - api: kernel32.SignalObjectAndWait\r\n          - api: kernel32.WaitForSingleObjectEx\r\n          - api: kernel32.WaitForMultipleObjects\r\n          - api: kernel32.WaitForMultipleObjectsEx\r\n          - api: kernel32.RegisterWaitForSingleObject\r\n          - api: WaitOnAddress\r\n          - api: user32.MsgWaitForMultipleObjects\r\n          - api: user32.MsgWaitForMultipleObjectsEx\r\n          - api: NtDelayExecution\r\n          - api: KeWaitForSingleObject\r\n          - api: KeDelayExecutionThread\r\n      - and:\r\n        - os: linux\r\n        - or:\r\n          - api: sleep\r\n          - api: usleep\r\n",
      "matches": [
        [
          {
            "type": "absolute",
            "value": 4199370
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": false,
                "node": {
                  "type": "statement",
                  "statement": {
                    "type": "and"
                  }
                },
                "children": [
                  {
                    "success": false,
                    "node": {
                      "type": "feature",
                      "feature": {
                        "type": "os",
                        "os": "linux"
                      }
                    },
                    "children": [],
                    "locations": [],
                    "captures": {}
                  },
                  {
                    "success": false,
                    "node": {
                      "type": "statement",
                      "statement": {
                        "type": "or"
                      }
                    },
                    "children": [
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "sleep"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "usleep"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      }
                    ],
                    "locations": [],
                    "captures": {}
                  }
                ],
                "locations": [],
                "captures": {}
              },
              {
                "success": true,
                "node": {
                  "type": "statement",
                  "statement": {
                    "type": "and"
                  }
                },
                "children": [
                  {
                    "success": true,
                    "node": {
                      "type": "feature",
                      "feature": {
                        "type": "os",
                        "os": "windows"
                      }
                    },
                    "children": [],
                    "locations": [
                      {
                        "type": "no address"
                      }
                    ],
                    "captures": {}
                  },
                  {
                    "success": true,
                    "node": {
                      "type": "statement",
                      "statement": {
                        "type": "or"
                      }
                    },
                    "children": [
                      {
                        "success": true,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.Sleep"
                          }
                        },
                        "children": [],
                        "locations": [
                          {
                            "type": "absolute",
                            "value": 4199375
                          }
                        ],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.SleepEx"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.WaitForSingleObject"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.SignalObjectAndWait"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.WaitForSingleObjectEx"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.WaitForMultipleObjects"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.WaitForMultipleObjectsEx"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.RegisterWaitForSingleObject"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "WaitOnAddress"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "user32.MsgWaitForMultipleObjects"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "user32.MsgWaitForMultipleObjectsEx"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "NtDelayExecution"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "KeWaitForSingleObject"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "KeDelayExecutionThread"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      }
                    ],
                    "locations": [],
                    "captures": {}
                  }
                ],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ]
      ]
    },
    "contain loop": {
      "meta": {
        "name": "contain loop",
        "authors": [
          "moritz.raabe@mandiant.com"
        ],
        "scope": "function",
        "attack": [],
        "mbc": [],
        "references": [],
        "examples": [
          "08AC667C65D36D6542917655571E61C8:0x406EAA"
        ],
        "description": "",
        "lib": true,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: contain loop\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    lib: true\r\n    scope: function\r\n    examples:\r\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\r\n  features:\r\n    - or:\r\n      - characteristic: loop\r\n      - characteristic: tight loop\r\n      - characteristic: recursive call\r\n",
      "matches": [
        [
          {
            "type": "absolute",
            "value": 4198587
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4198587
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "tight loop"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "recursive call"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ],
        [
          {
            "type": "absolute",
            "value": 4199045
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4199045
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "tight loop"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "recursive call"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ],
        [
          {
            "type": "absolute",
            "value": 4200332
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4200332
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "tight loop"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "recursive call"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ],
        [
          {
            "type": "absolute",
            "value": 4204670
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4204670
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "tight loop"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "recursive call"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ],
        [
          {
            "type": "absolute",
            "value": 4205125
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4205125
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "tight loop"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "recursive call"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ],
        [
          {
            "type": "absolute",
            "value": 4206752
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4206752
                  }
                ],
                "captures": {}
              },
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "tight loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4206780
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "recursive call"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ],
        [
          {
            "type": "absolute",
            "value": 4211438
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "loop"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4211438
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "tight loop"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "characteristic",
                    "characteristic": "recursive call"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ]
      ]
    },
    "download URL": {
      "meta": {
        "name": "download URL",
        "namespace": "communication/http/client",
        "authors": [
          "matthew.williams@mandiant.com",
          "michael.hunhoff@mandiant.com",
          "anushka.virgaonkar@mandiant.com"
        ],
        "scope": "function",
        "attack": [],
        "mbc": [
          {
            "parts": [
              "Communication",
              "HTTP Communication",
              "Download URL"
            ],
            "objective": "Communication",
            "behavior": "HTTP Communication",
            "method": "Download URL",
            "id": "C0002.006"
          }
        ],
        "references": [],
        "examples": [
          "F5C93AC768C8206E87544DDD76B3277C:0x100020F0",
          "Practical Malware Analysis Lab 20-01.exe_:0x401040"
        ],
        "description": "",
        "lib": false,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: download URL\r\n    namespace: communication/http/client\r\n    authors:\r\n      - matthew.williams@mandiant.com\r\n      - michael.hunhoff@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scope: function\r\n    mbc:\r\n      - Communication::HTTP Communication::Download URL [C0002.006]\r\n    examples:\r\n      - F5C93AC768C8206E87544DDD76B3277C:0x100020F0\r\n      - Practical Malware Analysis Lab 20-01.exe_:0x401040\r\n  features:\r\n    - or:\r\n      - api: urlmon.URLDownloadToFile\r\n      - api: urlmon.URLDownloadToCacheFile\r\n      - api: urlmon.URLOpenBlockingStream\r\n      - api: urlmon.URLOpenPullStream\r\n      - api: urlmon.URLOpenStream\r\n      - api: System.Net.WebClient::DownloadFile\r\n      - api: System.Net.WebClient::DownloadFileAsync\r\n      - api: System.Net.WebClient::DownloadFileTaskAsync\r\n      - api: Microsoft.VisualBasic.Devices.Network::DownloadFile\r\n",
      "matches": [
        [
          {
            "type": "absolute",
            "value": 4198819
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "urlmon.URLDownloadToFile"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "urlmon.URLDownloadToCacheFile"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4198921
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "urlmon.URLOpenBlockingStream"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "urlmon.URLOpenPullStream"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "urlmon.URLOpenStream"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.Net.WebClient::DownloadFile"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.Net.WebClient::DownloadFileAsync"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.Net.WebClient::DownloadFileTaskAsync"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "Microsoft.VisualBasic.Devices.Network::DownloadFile"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ]
      ]
    },
    "receive data": {
      "meta": {
        "name": "receive data",
        "namespace": "communication",
        "authors": [
          "william.ballenthin@mandiant.com"
        ],
        "scope": "function",
        "attack": [],
        "mbc": [
          {
            "parts": [
              "Command and Control",
              "C2 Communication",
              "Receive Data"
            ],
            "objective": "Command and Control",
            "behavior": "C2 Communication",
            "method": "Receive Data",
            "id": "B0030.002"
          }
        ],
        "references": [],
        "examples": [
          "BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60"
        ],
        "description": "all known techniques for receiving data from a potential C2 server",
        "lib": false,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: receive data\r\n    namespace: communication\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n    description: all known techniques for receiving data from a potential C2 server\r\n    scope: function\r\n    mbc:\r\n      - Command and Control::C2 Communication::Receive Data [B0030.002]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60\r\n  features:\r\n    - or:\r\n      - match: receive data on socket\r\n      - match: read data from Internet\r\n      - match: download URL\r\n",
      "matches": [
        [
          {
            "type": "absolute",
            "value": 4198819
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "match",
                    "match": "receive data on socket"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "match",
                    "match": "read data from Internet"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "match",
                    "match": "download URL"
                  }
                },
                "children": [
                  {
                    "success": true,
                    "node": {
                      "type": "statement",
                      "statement": {
                        "type": "or"
                      }
                    },
                    "children": [
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "urlmon.URLDownloadToFile"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": true,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "urlmon.URLDownloadToCacheFile"
                          }
                        },
                        "children": [],
                        "locations": [
                          {
                            "type": "absolute",
                            "value": 4198921
                          }
                        ],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "urlmon.URLOpenBlockingStream"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "urlmon.URLOpenPullStream"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "urlmon.URLOpenStream"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "System.Net.WebClient::DownloadFile"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "System.Net.WebClient::DownloadFileAsync"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "System.Net.WebClient::DownloadFileTaskAsync"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "Microsoft.VisualBasic.Devices.Network::DownloadFile"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      }
                    ],
                    "locations": [],
                    "captures": {}
                  }
                ],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4198819
                  }
                ],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ]
      ]
    },
    "get session user name": {
      "meta": {
        "name": "get session user name",
        "namespace": "host-interaction/session",
        "authors": [
          "moritz.raabe@mandiant.com",
          "anushka.virgaonkar@mandiant.com"
        ],
        "scope": "function",
        "attack": [
          {
            "parts": [
              "Discovery",
              "System Owner/User Discovery"
            ],
            "tactic": "Discovery",
            "technique": "System Owner/User Discovery",
            "subtechnique": "",
            "id": "T1033"
          },
          {
            "parts": [
              "Discovery",
              "Account Discovery"
            ],
            "tactic": "Discovery",
            "technique": "Account Discovery",
            "subtechnique": "",
            "id": "T1087"
          }
        ],
        "mbc": [],
        "references": [],
        "examples": [
          "Practical Malware Analysis Lab 14-01.exe_:0x401285"
        ],
        "description": "",
        "lib": false,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: get session user name\r\n    namespace: host-interaction/session\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scope: function\r\n    att&ck:\r\n      - Discovery::System Owner/User Discovery [T1033]\r\n      - Discovery::Account Discovery [T1087]\r\n    examples:\r\n      - Practical Malware Analysis Lab 14-01.exe_:0x401285\r\n  features:\r\n    - or:\r\n      - api: advapi32.GetUserName\r\n      - api: secur32.GetUserNameEx\r\n      - basic block:\r\n        - and:\r\n          # - match: get session information (see #463)\r\n          - api: wtsapi32.WTSQuerySessionInformation\r\n          - number: 5 = WTSUserName\r\n      - api: System.Security.Principal.WindowsIdentity::GetCurrent\r\n      - property/read: System.Environment::UserName\r\n",
      "matches": [
        [
          {
            "type": "absolute",
            "value": 4199045
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": true,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "advapi32.GetUserName"
                  }
                },
                "children": [],
                "locations": [
                  {
                    "type": "absolute",
                    "value": 4199243
                  }
                ],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "secur32.GetUserNameEx"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "match",
                    "match": "get session user name/0d7685dd34e24981be6ddfcf5a087668"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.Security.Principal.WindowsIdentity::GetCurrent"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "property",
                    "access": "read",
                    "property": "System.Environment::UserName"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ]
      ]
    },
    "write file on Windows": {
      "meta": {
        "name": "write file on Windows",
        "namespace": "host-interaction/file-system/write",
        "authors": [
          "william.ballenthin@mandiant.com",
          "anushka.virgaonkar@mandiant.com"
        ],
        "scope": "function",
        "attack": [],
        "mbc": [
          {
            "parts": [
              "File System",
              "Writes File"
            ],
            "objective": "File System",
            "behavior": "Writes File",
            "method": "",
            "id": "C0052"
          }
        ],
        "references": [],
        "examples": [
          "Practical Malware Analysis Lab 01-04.exe_:0x4011FC",
          "563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x1400025C4"
        ],
        "description": "",
        "lib": false,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: write file on Windows\r\n    namespace: host-interaction/file-system/write\r\n    authors:\r\n      - william.ballenthin@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    scope: function\r\n    mbc:\r\n      - File System::Writes File [C0052]\r\n    examples:\r\n      - Practical Malware Analysis Lab 01-04.exe_:0x4011FC\r\n      # ntdll\r\n      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x1400025C4\r\n  features:\r\n    - or:\r\n      - and:\r\n        - os: windows\r\n        - optional:\r\n          - basic block:\r\n            - or:\r\n              - number: 0x40000000 = GENERIC_WRITE\r\n              - number: 0x2 = FILE_WRITE_DATA\r\n              - match: create or open file\r\n        - or:\r\n          - api: kernel32.WriteFile\r\n          - api: kernel32.WriteFileEx\r\n          - api: NtWriteFile\r\n          - api: ZwWriteFile\r\n          - api: _fwrite\r\n          - api: fwrite\r\n      - api: System.IO.File::WriteAllBytes\r\n      - api: System.IO.File::WriteAllBytesAsync\r\n      - api: System.IO.File::WriteAllLines\r\n      - api: System.IO.File::WriteAllLinesAsync\r\n      - api: System.IO.File::WriteAllText\r\n      - api: System.IO.File::WriteAllTextAsync\r\n      - api: System.IO.File::AppendAllLines\r\n      - api: System.IO.File::AppendAllLinesAsync\r\n      - api: System.IO.File::AppendAllText\r\n      - api: System.IO.File::AppendAllTextAsync\r\n      - api: System.IO.File::AppendText\r\n      - api: System.IO.FileInfo::AppendText\r\n",
      "matches": [
        [
          {
            "type": "absolute",
            "value": 4205125
          },
          {
            "success": true,
            "node": {
              "type": "statement",
              "statement": {
                "type": "or"
              }
            },
            "children": [
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::WriteAllBytes"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::WriteAllBytesAsync"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::WriteAllLines"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::WriteAllLinesAsync"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::WriteAllText"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::WriteAllTextAsync"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::AppendAllLines"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::AppendAllLinesAsync"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::AppendAllText"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::AppendAllTextAsync"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.File::AppendText"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": false,
                "node": {
                  "type": "feature",
                  "feature": {
                    "type": "api",
                    "api": "System.IO.FileInfo::AppendText"
                  }
                },
                "children": [],
                "locations": [],
                "captures": {}
              },
              {
                "success": true,
                "node": {
                  "type": "statement",
                  "statement": {
                    "type": "and"
                  }
                },
                "children": [
                  {
                    "success": true,
                    "node": {
                      "type": "feature",
                      "feature": {
                        "type": "os",
                        "os": "windows"
                      }
                    },
                    "children": [],
                    "locations": [
                      {
                        "type": "no address"
                      }
                    ],
                    "captures": {}
                  },
                  {
                    "success": true,
                    "node": {
                      "type": "statement",
                      "statement": {
                        "type": "optional"
                      }
                    },
                    "children": [
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "match",
                            "match": "write file on Windows/6b779e7e550f4e5183a90fb03c51fe68"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      }
                    ],
                    "locations": [],
                    "captures": {}
                  },
                  {
                    "success": true,
                    "node": {
                      "type": "statement",
                      "statement": {
                        "type": "or"
                      }
                    },
                    "children": [
                      {
                        "success": true,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.WriteFile"
                          }
                        },
                        "children": [],
                        "locations": [
                          {
                            "type": "absolute",
                            "value": 4205455
                          }
                        ],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "kernel32.WriteFileEx"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "NtWriteFile"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "ZwWriteFile"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "_fwrite"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      },
                      {
                        "success": false,
                        "node": {
                          "type": "feature",
                          "feature": {
                            "type": "api",
                            "api": "fwrite"
                          }
                        },
                        "children": [],
                        "locations": [],
                        "captures": {}
                      }
                    ],
                    "locations": [],
                    "captures": {}
                  }
                ],
                "locations": [],
                "captures": {}
              }
            ],
            "locations": [],
            "captures": {}
          }
        ]
      ]
    },
    "reference Base64 string": {
      "meta": {
        "name": "reference Base64 string",
        "namespace": "data-manipulation/encoding/base64",
        "authors": [
          "moritz.raabe@mandiant.com"
        ],
        "scope": "file",
        "attack": [
          {
            "parts": [
              "Defense Evasion",
              "Obfuscated Files or Information"
            ],
            "tactic": "Defense Evasion",
            "technique": "Obfuscated Files or Information",
            "subtechnique": "",
            "id": "T1027"
          }
        ],
        "mbc": [
          {
            "parts": [
              "Data",
              "Encode Data",
              "Base64"
            ],
            "objective": "Data",
            "behavior": "Encode Data",
            "method": "Base64",
            "id": "C0026.001"
          },
          {
            "parts": [
              "Data",
              "Check String"
            ],
            "objective": "Data",
            "behavior": "Check String",
            "method": "",
            "id": "C0019"
          }
        ],
        "references": [],
        "examples": [
          "BFB9B5391A13D0AFD787E87AB90F14F5",
          "074072B261FC27B65C72671F13510C05",
          "5DB2D2BE20D59AA0BE6709A6850F1775"
        ],
        "description": "",
        "lib": false,
        "is_subscope_rule": false,
        "maec": {}
      },
      "source": "rule:\r\n  meta:\r\n    name: reference Base64 string\r\n    namespace: data-manipulation/encoding/base64\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scope: file\r\n    att&ck:\r\n      - Defense Evasion::Obfuscated Files or Information [T1027]\r\n    mbc:\r\n      - Data::Encode Data::Base64 [C0026.001]\r\n      - Data::Check String [C0019]\r\n    examples:\r\n      - BFB9B5391A13D0AFD787E87AB90F14F5\r\n      - 074072B261FC27B65C72671F13510C05\r\n      - 5DB2D2BE20D59AA0BE6709A6850F1775\r\n  features:\r\n    - string: /ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\r\n",
      "matches": [
        [
          {
            "type": "no address"
          },
          {
            "success": true,
            "node": {
              "type": "feature",
              "feature": {
                "type": "regex",
                "regex": "/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
              }
            },
            "children": [],
            "locations": [
              {
                "type": "file",
                "value": 20672
              }
            ],
            "captures": {
              "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/": [
                {
                  "type": "file",
                  "value": 20672
                }
              ]
            }
          }
        ]
      ]
    }
  }
}